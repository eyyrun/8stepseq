#include <avr/io.h>

void mydelay(long int k)
{
	long int i;
	for (i = 0; i < k; i++)
	{
		asm("nop"); //no operation for one cycle
	}
}




int main()
{
	DDRB = 0b11111000; //pin 8 - 10 inputs, 11-13 outputs
	//set up ADC
	ADMUX = (1 << REFS0);
	//ADCSRB untouched as it is default in free-running-mode after reset
	// power on ADC, activate free running mode, start converting, 128 prescaler (->125kHz)
	ADCSRA |= (1<<ADEN)|(1<<ADATE)|(1<<ADSC)|(1<<ADPS2)|(1<<ADPS1)|(1<<ADPS0);

	int adc_value;

	//for(int i=0; i<8; i++)
	//{
	while(1)
	{
		int i;
		adc_value = ADCW;
		if(PINB & (1<<2)) //if on/off switch is ON
		{
			PORTB |= (1<<5);
			for(i=adc_value; i>0+10; i--)
			{
				PORTB |= (1<<3);
				mydelay(adc_value-i); //crest widens
				adc_value = ADCW;
				PORTB &= ~(1<<3);
				mydelay(i);   //trough shrinks
			}
			adc_value = ADCW;
			for(i=0; i<adc_value-10; i++)
			{
				PORTB |= (1<<3);
				mydelay(adc_value-i); //crest shrinks
				adc_value = ADCW;
				PORTB &= ~(1<<3);
				mydelay(i); 	  //trough widens
			}
		}
		else
			PORTB &= ~(1<<5);
	}

	//}



	return 0;
}
